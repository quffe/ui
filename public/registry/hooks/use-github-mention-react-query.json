{
  "name": "use-github-mention-react-query",
  "type": "registry:hook",
  "namespace": "@ui-components/hooks",
  "description": "use-github-mention hook (React Query adapter)",
  "dependencies": ["@tanstack/react-query"],
  "registryDependencies": [],
  "files": [
    {
      "type": "registry:hook",
      "path": "hooks/use-github-mention-react-query.ts",
      "content": "\"use client\"\n\nimport { parseGithubUrl } from \"@/lib/github/parse-url\"\nimport type { GithubResource, ResourceKind } from \"@/lib/github/types\"\nimport { useQuery } from \"@tanstack/react-query\"\n\n// Minimal inlined endpoint + fetch to avoid extra files in consumer apps\nfunction clientEndpointFor(url: string): string | null {\n  const parsed = parseGithubUrl(url)\n  if (parsed.kind === \"unknown\") return null\n  switch (parsed.kind) {\n    case \"pull\": return `https://api.github.com/repos/${parsed.owner}/${parsed.repo}/pulls/${parsed.number}`\n    case \"issue\": return `https://api.github.com/repos/${parsed.owner}/${parsed.repo}/issues/${parsed.number}`\n    case \"user\": return `https://api.github.com/users/${parsed.username}`\n    case \"repo\": return `https://api.github.com/repos/${parsed.owner}/${parsed.repo}`\n    default: return null\n  }\n}\n\nasync function getGithubResource(url: string): Promise<GithubResource> {\n  const res = await fetch(url, { headers: { Accept: \"application/vnd.github+json\" }, cache: \"force-cache\" })\n  if (!res.ok) throw new Error(`GitHub request failed: ${res.status}`)\n  const json = (await res.json()) as unknown\n  return normalizeGithubResource(json)\n}\n\nfunction normalizeGithubResource(data: unknown): GithubResource {\n  if (typeof data !== \"object\" || data == null) throw new Error(\"Unsupported GitHub response shape\")\n  const obj = data as Record<string, unknown>\n  if (\"merged_at\" in obj || \"draft\" in obj) {\n    const user = obj.user as Record<string, unknown> | undefined\n    return { kind: \"pull\", id: obj.id as number, number: obj.number as number, state: (obj.state as string) === \"open\" ? \"open\" : \"closed\", merged: Boolean(obj.merged_at), draft: Boolean(obj.draft), title: obj.title as string, user: { login: user?.login as string, avatar_url: (user?.avatar_url as string) ?? null, html_url: user?.html_url as string }, created_at: obj.created_at as string, html_url: obj.html_url as string }\n  }\n  if (\"title\" in obj && \"comments\" in obj && \"user\" in obj && !(\"merged_at\" in obj)) {\n    const user = obj.user as Record<string, unknown> | undefined\n    return { kind: \"issue\", id: obj.id as number, number: obj.number as number, state: (obj.state as string) === \"open\" ? \"open\" : \"closed\", title: obj.title as string, user: { login: user?.login as string, avatar_url: (user?.avatar_url as string) ?? null, html_url: user?.html_url as string }, created_at: obj.created_at as string, html_url: obj.html_url as string, comments: obj.comments as number }\n  }\n  if (\"login\" in obj) {\n    return { kind: \"user\", id: obj.id as number, login: obj.login as string, name: (obj.name as string) ?? null, avatar_url: (obj.avatar_url as string) ?? null, html_url: obj.html_url as string }\n  }\n  if (\"full_name\" in obj) {\n    return { kind: \"repo\", id: obj.id as number, name: obj.name as string, full_name: obj.full_name as string, description: (obj.description as string) ?? null, html_url: obj.html_url as string }\n  }\n  throw new Error(\"Unsupported GitHub response shape\")\n}\n\nexport type UseGithubMentionQueryResult = {\n  kind: ResourceKind\n  data: GithubResource | null\n  isLoading: boolean\n  error: Error | null\n  refetch: () => void\n  invalidReason?: \"EMPTY_URL\" | \"INVALID_GITHUB_URL\"\n}\n\nexport function useGithubMentionQuery(url: string): UseGithubMentionQueryResult {\n  const trimmed = (url ?? \"\").trim()\n  const invalidReason = !trimmed ? \"EMPTY_URL\" : parseGithubUrl(trimmed).kind === \"unknown\" ? \"INVALID_GITHUB_URL\" : undefined\n  const endpoint = invalidReason ? null : clientEndpointFor(trimmed)\n  const query = useQuery<GithubResource>({ queryKey: [\"github-resource\", endpoint], queryFn: () => getGithubResource(trimmed), enabled: Boolean(endpoint), staleTime: 300000 })\n  const kind: ResourceKind = parseGithubUrl(trimmed).kind\n  return { kind, data: query.data ?? null, isLoading: query.isLoading, error: (query.error as Error | null) ?? null, refetch: () => query.refetch(), invalidReason }\n}\n"
    }
  ]
}

